
<html>
  <head lang="zh">
        <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
        <meta content="yes" name="apple-mobile-web-app-capable"/>
        <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
        <meta content="telephone=no" name="format-detection"/>
        <meta name="renderer" content="webkit">
    <title>MyBatis-Plus | Iktsuarpok</title>
<link href="https://Squid-dot.github.io/styles/main.css" type="text/css" rel="stylesheet"/>
<script type="text/javascript" src="https://Squid-dot.github.io/media/scripts/jquery.js"></script>
<script type="text/javascript" src="https://Squid-dot.github.io/media/scripts/basic.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  </head>

  <body>
     <div class="header">
      <div class="logo_title">
		  
        <div class="title animated fadeInDown"><img src="https://Squid-dot.github.io/images/avatar.png?v=1585478884013"/>

          <h1 title="Iktsuarpok" class="weaklink"><a href="/">Iktsuarpok</a>

          </h1>

          <div class="navbar weaklink">
            <div class="normal_nav">

<div class="bitcron_nav_container">


  <div class="bitcron_nav">
    <div class="mixed_site_nav_wrap site_nav_wrap">
		
      <ul class="mixed_site_nav site_nav sm sm-base">
 
  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="https://Squid-dot.github.io" class="selected active current nav__item" >首页</a>

  </li>
 
  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="https://Squid-dot.github.io/tags" class="selected active current nav__item" >标签</a>

  </li>
 
  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="https://Squid-dot.github.io/archives" class="selected active current nav__item" >归档</a>

  </li>
 

      </ul>

      <div class="clear clear_nav_inline_end"></div>

    </div>

  </div>



  <div class="clear clear_nav_end"></div>

</div>

            </div>

            <div class="hamberger"><i class="fa fa-bars"></i>
<i class="fa fa-times"></i>

            </div>

          </div>

        </div>

      </div>

      <div class="hidden_nav animated fadeInDown">

<div class="bitcron_nav_container">


  <div class="bitcron_nav">
    <div class="mixed_site_nav_wrap site_nav_wrap">
      <ul class="mixed_site_nav site_nav sm sm-base">
		  
	
  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="https://Squid-dot.github.io" class="selected active current nav__item" >首页</a>

  </li>


  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="https://Squid-dot.github.io/tags" class="selected active current nav__item" >标签</a>

  </li>


  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="https://Squid-dot.github.io/archives" class="selected active current nav__item" >归档</a>

  </li>





      </ul>

      <div class="clear clear_nav_inline_end"></div>

    </div>

  </div>



  <div class="clear clear_nav_end"></div>

</div>

      </div>

    </div>


    <div class="main">
      <div class="main-inner">


<div class="content">






  <div class="post_page" >

<div class="post">
  <div class="post_title sm_margin">
    <h2><a>MyBatis-Plus</a>



    </h2>
  </div>

  <div class="post_details">
    <div class="info"><i class="fa fa-clock-o"></i>
<span class="date_info">2020-03-29</span>
<i class="fa fa-eye"></i>

<span class="date_info"><span id="busuanzi_value_page_pv"></span> Views</span>


<i class="fa fa-bookmark-o"></i>
<span class="tags_info weaklink">
	
	<a href="https://Squid-dot.github.io/tag/TUU11CZuU/" class="tag">框架</a>


</span>


    </div>

  </div>





  <div class="post_content markdown"><p class="md_block">
    <span class="md_line md_line_start md_line_end"><h1 id="mybatis-plus">MyBatis-Plus</h1>
<h2 id="mybatis-plus概述">MyBatis-Plus概述</h2>
<blockquote>
<p>简介</p>
</blockquote>
<p>MyBatis-Plus（简称 MP）是一个 MyBatis 的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。</p>
<p><a href="https://mp.baomidou.com/">官网</a></p>
<blockquote>
<p>特性</p>
</blockquote>
<ul>
<li><strong>无侵入</strong>：只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑</li>
<li><strong>损耗小</strong>：启动即会自动注入基本 CURD，性能基本无损耗，直接面向对象操作</li>
<li><strong>强大的 CRUD 操作</strong>：内置通用 Mapper、通用 Service，仅仅通过少量配置即可实现单表大部分 CRUD 操作，更有强大的条件构造器，满足各类使用需求</li>
<li><strong>支持 Lambda 形式调用</strong>：通过 Lambda 表达式，方便的编写各类查询条件，无需再担心字段写错</li>
<li><strong>支持主键自动生成</strong>：支持多达 4 种主键策略（内含分布式唯一 ID 生成器 - Sequence），可自由配置，完美解决主键问题</li>
<li><strong>支持 ActiveRecord 模式</strong>：支持 ActiveRecord 形式调用，实体类只需继承 Model 类即可进行强大的 CRUD 操作</li>
<li><strong>支持自定义全局通用操作</strong>：支持全局通用方法注入（ Write once, use anywhere ）</li>
<li><strong>内置代码生成器</strong>：采用代码或者 Maven 插件可快速生成 Mapper 、 Model 、 Service 、 Controller 层代码，支持模板引擎，更有超多自定义配置等您来使用</li>
<li><strong>内置分页插件</strong>：基于 MyBatis 物理分页，开发者无需关心具体操作，配置好插件之后，写分页等同于普通 List 查询</li>
<li><strong>分页插件支持多种数据库</strong>：支持 MySQL、MariaDB、Oracle、DB2、H2、HSQL、SQLite、Postgre、SQLServer 等多种数据库</li>
<li><strong>内置性能分析插件</strong>：可输出 Sql 语句以及其执行时间，建议开发测试时启用该功能，能快速揪出慢查询</li>
<li><strong>内置全局拦截插件</strong>：提供全表 delete 、 update 操作智能分析阻断，也可自定义拦截规则，预防误操作</li>
</ul>
<hr>
<h2 id="快速开始举例">快速开始举例</h2>
<p>快速开始：<a href="%5Bhttps://mp.baomidou.com/guide/quick-start.html#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B7%A5%E7%A8%8B%5D(https://mp.baomidou.com/guide/quick-start.html#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B7%A5%E7%A8%8B)">初始化工程</a></p>
<blockquote>
<p>步骤</p>
</blockquote>
<ol>
<li>创建数据库<code>mybatis_plus</code></li>
<li>创建表<code>User</code>并添加数据</li>
</ol>
<pre><code class="language-sql">-- 建立表
DROP TABLE IF EXISTS user;
CREATE TABLE user
(
	id BIGINT(20) NOT NULL COMMENT '主键ID',
	name VARCHAR(30) NULL DEFAULT NULL COMMENT '姓名',
	age INT(11) NULL DEFAULT NULL COMMENT '年龄',
	email VARCHAR(50) NULL DEFAULT NULL COMMENT '邮箱',
	PRIMARY KEY (id)
);

-- 添加数据
DELETE FROM user;
INSERT INTO user (id, name, age, email) VALUES
(1, 'Jone', 18, 'test1@baomidou.com'),
(2, 'Jack', 20, 'test2@baomidou.com'),
(3, 'Tom', 28, 'test3@baomidou.com'),
(4, 'Sandy', 21, 'test4@baomidou.com'),
(5, 'Billie', 24, 'test5@baomidou.com');
</code></pre>
<ol start="3">
<li>引入所需依赖</li>
</ol>
<p><a href="https://mp.baomidou.com/guide/install.html#release">所需依赖地址</a></p>
<pre><code class="language-java">        &lt;!-- 数据库驱动 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- lombok --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;version&gt;1.18.10&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- MyBatis-Plus --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;3.3.1.tmp&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<ol start="4">
<li>配置</li>
</ol>
<pre><code class="language-yaml">spring:
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://localhost:3306/
    username: root
    password: 123456
</code></pre>
<ol start="5">
<li>编码</li>
</ol>
<ul>
<li>仅需要在对应的<code>mapper</code>上继承自<code>BaseMapper&lt;type&gt;</code>接口即可使用</li>
</ul>
<pre><code class="language-javascript">//实体类
@Data
@AllArgsConstructor
@NoArgsConstructor
public class User {
    private Long id;
    private String name;
    private Integer age;
    private String email;
}
</code></pre>
<pre><code class="language-java">//Mapper接口
@Repository
public interface UserMapper extends BaseMapper&lt;User&gt; {
    //如此，所有的CRUD操作已经自动编写完成
}

</code></pre>
<pre><code>//启动类（添加MapperScan）
@MapperScan(&quot;com.squid.mapper&quot;)
@SpringBootApplication
public class MybatisPlusApplication {

    public static void main(String[] args) {
        SpringApplication.run(MybatisPlusApplication.class, args);
    }

}
</code></pre>
<ol start="6">
<li>开始使用</li>
</ol>
<pre><code class="language-java">@SpringBootTest
class MybatisPlusApplicationTests {

    @Autowired
    private UserMapper userMapper;

    @Test
    void contextLoads() {
        List&lt;User&gt; users = userMapper.selectList(null);
        users.forEach(System.out::println);
    }

}
</code></pre>
<blockquote>
<p>UserMapper 中的 <code>selectList()</code> 方法的参数为 MP 内置的条件封装器 <code>Wrapper</code>，所以不填写就是无任何条件</p>
</blockquote>
<p>控制台输出：</p>
<pre><code>User(id=1, name=Jone, age=18, email=test1@baomidou.com)
User(id=2, name=Jack, age=20, email=test2@baomidou.com)
User(id=3, name=Tom, age=28, email=test3@baomidou.com)
User(id=4, name=Sandy, age=21, email=test4@baomidou.com)
User(id=5, name=Billie, age=24, email=test5@baomidou.com)
</code></pre>
<p><strong>小结：</strong></p>
<p>通过以上几个步骤，便可以实现简单的CRUD操作，并且不用编写XML文件。</p>
<p>从以上步骤中，可以看到集成<code>MyBatis-Plus</code>，只需要引入 starter 工程，并配置 mapper 扫描路径即可。</p>
<hr>
<h2 id="日志配置">日志配置</h2>
<blockquote>
<p>在配置文件中添加如下</p>
</blockquote>
<pre><code>mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

</code></pre>
<p>如上方式采用了默认日志，使用后控制台输出如下：</p>
<pre><code>Creating a new SqlSession
SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@5984feef] was not registered for synchronization because synchronization is not active
JDBC Connection [HikariProxyConnection@345703799 wrapping com.mysql.cj.jdbc.ConnectionImpl@5740ff5e] will not be managed by Spring
==&gt;  Preparing: SELECT id,name,age,email FROM user 
==&gt; Parameters: 
&lt;==    Columns: id, name, age, email
&lt;==        Row: 1, Jone, 18, test1@baomidou.com
&lt;==        Row: 2, Jack, 20, test2@baomidou.com
&lt;==        Row: 3, Tom, 28, test3@baomidou.com
&lt;==        Row: 4, Sandy, 21, test4@baomidou.com
&lt;==        Row: 5, Billie, 24, test5@baomidou.com
&lt;==      Total: 5

</code></pre>
<p>可以看到，进行了JDBC连接，并且采用了<code>Hikari</code>数据源，并且自动生成了查询全部<code>User</code>的sql语句。</p>
<p><strong>小结：</strong></p>
<p>配置了日志后，可以更方便的查看到具体运行情况，便于个人学习。</p>
<hr>
<h2 id="注解">注解</h2>
<blockquote>
<p>简介</p>
</blockquote>
<p>使用MyBatis-Plus时需要使用到注解功能，相关可以查阅<a href="https://mp.baomidou.com/guide/annotation.html">注解</a></p>
<hr>
<h2 id="crud接口">CRUD接口</h2>
<h3 id="mapper-crud接口">Mapper CRUD接口</h3>
<blockquote>
<p>说明</p>
</blockquote>
<ul>
<li>通用 CRUD 封装<code>BaseMapper</code>接口，为 <code>Mybatis-Plus</code> 启动时自动解析实体表关系映射转换为 <code>Mybatis</code> 内部对象注入容器</li>
<li>泛型 <code>T</code> 为任意实体对象</li>
<li>参数 <code>Serializable</code> 为任意类型主键 <code>Mybatis-Plus</code> 不推荐使用复合主键约定每一张表都有自己的唯一 <code>id</code> 主键</li>
<li>对象 <code>Wrapper</code> 为条件构造器</li>
</ul>
<p>使用CRUD操作时，仅需使用继承自<code>BaseMapper</code>接口的接口，调用如下方法即可。</p>
<h4 id="insert">Insert</h4>
<pre><code class="language-java">// 插入一条记录
int insert(T entity);

</code></pre>
<p><strong>可以通过 @TableId 注解进行主键注解</strong></p>
<h5 id="参数说明">参数说明</h5>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">参数名</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">T</td>
<td style="text-align:center">entity</td>
<td style="text-align:center">实体对象</td>
</tr>
</tbody>
</table>
<h5 id="主键生成算法-雪花算法">主键生成算法--雪花算法</h5>
<p><a href="https://www.cnblogs.com/pangguoming/p/8064549.html">分布式系统唯一ID生成方案汇总</a></p>
<p>当插入时如果未给出ID，将会使用雪花算法生成。</p>
<blockquote>
<p>雪花算法</p>
</blockquote>
<p>snowflake是Twitter开源的分布式ID生成算法，结果是一个long型的ID。其核心思想是：使用41bit作为毫秒数，10bit作为机器的ID（5个bit是数据中心，5个bit的机器ID），12bit作为毫秒内的流水号（意味着每个节点在每毫秒可以产生 4096 个 ID），最后还有一个符号位，永远是0。 可以保证几乎全球唯一。</p>
<h4 id="delete">Delete</h4>
<pre><code class="language-java">// 根据 entity 条件，删除记录
int delete(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; wrapper);
// 删除（根据ID 批量删除）
int deleteBatchIds(@Param(Constants.COLLECTION) Collection&lt;? extends Serializable&gt; idList);
// 根据 ID 删除
int deleteById(Serializable id);
// 根据 columnMap 条件，删除记录
int deleteByMap(@Param(Constants.COLUMN_MAP) Map&lt;String, Object&gt; columnMap);

</code></pre>
<h5 id="参数说明-2">参数说明</h5>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">参数名</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Wrapper<T></td>
<td style="text-align:center">wrapper</td>
<td style="text-align:center">实体对象封装操作类（可以为 null）</td>
</tr>
<tr>
<td style="text-align:center">Collection&lt;? extends Serializable&gt;</td>
<td style="text-align:center">idList</td>
<td style="text-align:center">主键ID列表(不能为 null 以及 empty)</td>
</tr>
<tr>
<td style="text-align:center">Serializable</td>
<td style="text-align:center">id</td>
<td style="text-align:center">主键ID</td>
</tr>
<tr>
<td style="text-align:center">Map&lt;String, Object&gt;</td>
<td style="text-align:center">columnMap</td>
<td style="text-align:center">表字段 map 对象</td>
</tr>
</tbody>
</table>
<h4 id="update">Update</h4>
<pre><code class="language-java">// 根据 whereEntity 条件，更新记录
int update(@Param(Constants.ENTITY) T entity, @Param(Constants.WRAPPER) Wrapper&lt;T&gt; updateWrapper);
// 根据 ID 修改
int updateById(@Param(Constants.ENTITY) T entity);

</code></pre>
<h5 id="参数说明-3">参数说明</h5>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">参数名</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">T</td>
<td style="text-align:center">entity</td>
<td style="text-align:center">实体对象 (set 条件值,可为 null)</td>
</tr>
<tr>
<td style="text-align:center">Wrapper<T></td>
<td style="text-align:center">updateWrapper</td>
<td style="text-align:center">实体对象封装操作类（可以为 null,里面的 entity 用于生成 where 语句）</td>
</tr>
</tbody>
</table>
<h4 id="select">Select</h4>
<pre><code class="language-java">// 根据 ID 查询
T selectById(Serializable id);
// 根据 entity 条件，查询一条记录
T selectOne(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);

// 查询（根据ID 批量查询）
List&lt;T&gt; selectBatchIds(@Param(Constants.COLLECTION) Collection&lt;? extends Serializable&gt; idList);
// 根据 entity 条件，查询全部记录
List&lt;T&gt; selectList(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);
// 查询（根据 columnMap 条件）
List&lt;T&gt; selectByMap(@Param(Constants.COLUMN_MAP) Map&lt;String, Object&gt; columnMap);
// 根据 Wrapper 条件，查询全部记录
List&lt;Map&lt;String, Object&gt;&gt; selectMaps(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);
// 根据 Wrapper 条件，查询全部记录。注意： 只返回第一个字段的值
List&lt;Object&gt; selectObjs(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);

// 根据 entity 条件，查询全部记录（并翻页）
IPage&lt;T&gt; selectPage(IPage&lt;T&gt; page, @Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);
// 根据 Wrapper 条件，查询全部记录（并翻页）
IPage&lt;Map&lt;String, Object&gt;&gt; selectMapsPage(IPage&lt;T&gt; page, @Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);
// 根据 Wrapper 条件，查询总记录数
Integer selectCount(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);

</code></pre>
<h5 id="参数说明-4">参数说明</h5>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">参数名</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Serializable</td>
<td style="text-align:center">id</td>
<td style="text-align:center">主键ID</td>
</tr>
<tr>
<td style="text-align:center">Wrapper<T></td>
<td style="text-align:center">queryWrapper</td>
<td style="text-align:center">实体对象封装操作类（可以为 null）</td>
</tr>
<tr>
<td style="text-align:center">Collection&lt;? extends Serializable&gt;</td>
<td style="text-align:center">idList</td>
<td style="text-align:center">主键ID列表(不能为 null 以及 empty)</td>
</tr>
<tr>
<td style="text-align:center">Map&lt;String, Object&gt;</td>
<td style="text-align:center">columnMap</td>
<td style="text-align:center">表字段 map 对象</td>
</tr>
<tr>
<td style="text-align:center">IPage<T></td>
<td style="text-align:center">page</td>
<td style="text-align:center">分页查询条件（可以为 RowBounds.DEFAULT）</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="条件构造器">条件构造器</h2>
<blockquote>
<p>作用</p>
</blockquote>
<p>用于查询时对于条件选择的添加，具体参考<a href="https://mp.baomidou.com/guide/wrapper.html#abstractwrapper">文档-条件构造器</a></p>
<h5 id="条件构造器的使用">条件构造器的使用</h5>
<pre><code class="language-java">QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;();
wrapper.isNotNull(&quot;name&quot;)           //名字不为空
    .ge(&quot;age&quot;,12);          //年龄大于等于12
userMapper.selectList(wrapper);

</code></pre>
<hr>
<h2 id="代码生成器">代码生成器</h2>
<blockquote>
<p>作用</p>
</blockquote>
<p>用于自动生成各层之间的代码</p>
<blockquote>
<p>使用方式</p>
</blockquote>
<pre><code class="language-java">//构建一个代码自动生成器对象、
AutoGenerator generator = new AutoGenerator();
generator.setTemplateEngine(new FreemarkerTemplateEngine());//选择模板引擎，可以自定义

//配置策略
//1.全局配置
GlobalConfig globalConfig = new GlobalConfig();
globalConfig.setOutputDir(System.getProperty(&quot;user.dir&quot;) + &quot;/src/main/java&quot;);
globalConfig.setAuthor(&quot;Squid&quot;);
globalConfig.setOpen(false);
globalConfig.setFileOverride(false);
globalConfig.setSwagger2(true);

//2.设置数据源
DataSourceConfig dataSourceConfig = new DataSourceConfig();
dataSourceConfig.setUrl(&quot;jdbc:mysql://localhost:3306/ant?useUnicode=true&amp;useSSL=false&amp;characterEncoding=utf8&quot;);
dataSourceConfig.setDriverName(&quot;com.mysql.jdbc.Driver&quot;);
dataSourceConfig.setUsername(&quot;root&quot;);
dataSourceConfig.setPassword(&quot;password&quot;);
dataSourceConfig.setDbType(DbType.MYSQL);
generator.setDataSource(dataSourceConfig);

//3.包配置
PackageConfig pc = new PackageConfig();
pc.setModuleName(&quot;blog&quot;);
pc.setParent(&quot;com.squid&quot;);
pc.setEntity(&quot;entity&quot;);
pc.setMapper(&quot;mapper&quot;);
pc.setService(&quot;service&quot;);
pc.setController(&quot;controller&quot;);
generator.setPackageInfo(pc);

//4.策略配置
StrategyConfig strategy = new StrategyConfig();
strategy.setInclude(&quot;user&quot;);
strategy.setNaming(NamingStrategy.underline_to_camel);
strategy.setColumnNaming(NamingStrategy.underline_to_camel);
strategy.setEntityLombokModel(true);
strategy.setLogicDeleteFieldName(&quot;deleted&quot;);
	//自动填充
TableFill gmtCreate = new TableFill(&quot;gmt_create&quot;,FieldFill.INSERT);
TableFill gmtUpdate = new TableFill(&quot;gmt_update&quot;,FieldFill.INSERT_UPDATE);
ArrayList&lt;TableFill&gt; tableFills = new ArrayList&lt;&gt;();
tableFills.add(gmtCreate);
tableFills.add(gmtUpdate);
strategy.setTableFillList(tableFills);
	//乐观锁
strategy.setVersionFieldName(&quot;version&quot;);
generator.setStrategy(strategy);
generator.execute();	//执行

</code></pre>
<hr>
<h2 id="扩展插件">扩展插件</h2>
<h5 id="自动填充功能">自动填充功能</h5>
<blockquote>
<p>说明</p>
</blockquote>
<p>该功能适用于 Insert 操作和 Update 操作。通过 实现元对象处理器接口：com.baomidou.mybatisplus.core.handlers.MetaObjectHandler 来实现对于添加、更新操作的自动填充。</p>
<blockquote>
<p>示例</p>
</blockquote>
<ul>
<li>注解填充字段</li>
</ul>
<pre><code class="language-java">@Data
@AllArgsConstructor
@NoArgsConstructor
public class User {
    private Long id;
    private String name;
    private Integer age;
    private String email;
    @TableField(fill = FieldFill.INSERT)    //填充字段 添加
    private Date gmtCreate;
    @TableField(fill = FieldFill.INSERT_UPDATE) //填充字段 添加与更新
    private Date gmtModify;
}

</code></pre>
<ul>
<li>实现自定义类</li>
</ul>
<pre><code class="language-java">@Component  //需要添加至IOC容器中
public class MyMetaObjectHandler implements MetaObjectHandler {
    //插入时的填充策略
    @Override
    public void insertFill(MetaObject metaObject) {
        this.setFieldValByName(&quot;gmtCreate&quot;,new Date(),metaObject);
        this.setFieldValByName(&quot;gmtModify&quot;,new Date(),metaObject);
    }

    //更新时的填充策略
    @Override
    public void updateFill(MetaObject metaObject) {
        this.setFieldValByName(&quot;gmtModify&quot;,new Date(),metaObject);
    }
}

</code></pre>
<h5 id="乐观锁插件">乐观锁插件</h5>
<blockquote>
<p>乐观锁简介</p>
</blockquote>
<p>顾名思义，非常乐观，不论做什么都认为不会出现问题，因此不论做什么都不会上锁。</p>
<blockquote>
<p>乐观锁的实现方式</p>
</blockquote>
<ul>
<li>取出记录时，获取当前的version</li>
<li>执行更新时，set version = newVersion where version = oldVersion</li>
<li>如果 version != oldVersion 则更新失败</li>
</ul>
<blockquote>
<p>乐观锁插件</p>
</blockquote>
<ol>
<li>在对应的实体类字段中添加注解</li>
</ol>
<pre><code class="language-java">@Version
private Integer version;

</code></pre>
<p><strong>特别说明:</strong></p>
<p><strong>支持的数据类型只有:int,Integer,long,Long,Date,Timestamp,LocalDateTime</strong></p>
<p>整数类型下 <code>newVersion = oldVersion + 1</code></p>
<p><code>newVersion</code> 会回写到 <code>entity</code> 中</p>
<p>仅支持 <code>updateById(id)</code> 与 <code>update(entity, wrapper)</code> 方法</p>
<p><strong>在 <code>update(entity, wrapper)</code> 方法下, <code>wrapper</code> 不能复用!!!</strong></p>
<ol start="2">
<li>配置插件</li>
</ol>
<p>spring xml:</p>
<pre><code class="language-xml">&lt;bean class=&quot;com.baomidou.mybatisplus.extension.plugins.OptimisticLockerInterceptor&quot;/&gt;

</code></pre>
<p>spring boot:</p>
<pre><code class="language-java">@Bean
public OptimisticLockerInterceptor optimisticLockerInterceptor() {
    return new OptimisticLockerInterceptor();
}

</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="language-java">@Configuration
@MapperScan(&quot;com.squid.mapper&quot;)
@EnableTransactionManagement
public class MyBatisPlusConfig {
    @Bean
    public OptimisticLockerInterceptor optimisticLockerInterceptor() {
        return new OptimisticLockerInterceptor();
    }
}


</code></pre>
<h5 id="分页插件">分页插件</h5>
<blockquote>
<p>作用</p>
</blockquote>
<p>实现分页查询效果</p>
<blockquote>
<p>使用方式</p>
</blockquote>
<ol>
<li>配置插件</li>
</ol>
<p>spring xml:</p>
<pre><code class="language-xml">&lt;property name=&quot;plugins&quot;&gt;
    &lt;array&gt;
        &lt;bean class=&quot;com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor&quot;&gt;
            &lt;property name=&quot;sqlParser&quot; ref=&quot;自定义解析类、可以没有&quot;/&gt;
            &lt;property name=&quot;dialectClazz&quot; value=&quot;自定义方言类、可以没有&quot;/&gt;
            &lt;!-- COUNT SQL 解析.可以没有 --&gt;
            &lt;property name=&quot;countSqlParser&quot; ref=&quot;countSqlParser&quot;/&gt;
        &lt;/bean&gt;
    &lt;/array&gt;
&lt;/property&gt;

&lt;bean id=&quot;countSqlParser&quot; class=&quot;com.baomidou.mybatisplus.extension.plugins.pagination.optimize.JsqlParserCountOptimize&quot;&gt;
    &lt;!-- 设置为 true 可以优化部分 left join 的sql --&gt;
    &lt;property name=&quot;optimizeJoin&quot; value=&quot;true&quot;/&gt;
&lt;/bean&gt;

</code></pre>
<p>Springboot方式：</p>
<pre><code class="language-java">@Bean
    public PaginationInterceptor paginationInterceptor() {
        PaginationInterceptor paginationInterceptor = new PaginationInterceptor();
        // 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false
        // paginationInterceptor.setOverflow(false);
        // 设置最大单页限制数量，默认 500 条，-1 不受限制
        // paginationInterceptor.setLimit(500);
        // 开启 count 的 join 优化,只针对部分 left join
        paginationInterceptor.setCountSqlParser(new JsqlParserCountOptimize(true));
        return paginationInterceptor;
    }

</code></pre>
<ol start="2">
<li>使用</li>
</ol>
<p>spring方式：</p>
<pre><code class="language-xml">&lt;select id=&quot;selectPageVo&quot; resultType=&quot;com.baomidou.cloud.entity.UserVo&quot;&gt;
    SELECT id,name FROM user WHERE state=#{state}
&lt;/select&gt;

</code></pre>
<p>springboot方式：</p>
<pre><code class="language-java">Page&lt;User&gt; page = new Page&lt;&gt;(2,5);
userMapper.selectPage(page,null);
page.getRecords().forEach(System.out::println);

</code></pre>
<h5 id="逻辑删除组件">逻辑删除组件</h5>
<blockquote>
<p>作用</p>
</blockquote>
<p>在数据库中定义的标识，例如flag，当flag = 0时认为未删除，查询时显示，flag = 1时则显示</p>
<blockquote>
<p>使用方式</p>
</blockquote>
<ul>
<li>application.yml 加入配置(如果默认值和mp默认的一样,该配置可无):</li>
</ul>
<pre><code class="language-yml">mybatis-plus:
  global-config:
    db-config:
      logic-delete-field: flag  #全局逻辑删除字段值 3.3.0开始支持，详情看下面。
      logic-delete-value: 1 # 逻辑已删除值(默认为 1)
      logic-not-delete-value: 0 # 逻辑未删除值(默认为 0)

</code></pre>
<ul>
<li>配置类中添加 Bean(3.1.1开始不再需要这一步)：</li>
</ul>
<pre><code class="language-java"> 	@Bean
    public ISqlInjector sqlInjector() {
        return new LogicSqlInjector();
    }

</code></pre>
<ul>
<li>
<p>实体类字段上加上<code>@TableLogic</code>注解</p>
<pre><code class="language-java">@TableLogic
private Integer deleted;

</code></pre>
</li>
<li>
<p>全局逻辑删除: 3.3.0开始支持</p>
</li>
</ul>
<p>如果公司代码比较规范，比如统一了全局都是flag为逻辑删除字段。</p>
<p>使用此配置则不需要在实体类上添加 @TableLogic。</p>
<p>但如果实体类上有 @TableLogic 则以实体上的为准，忽略全局。 即先查找注解再查找全局，都没有则此表没有逻辑删除。</p>
<pre><code class="language-yaml">mybatis-plus:
  global-config:
    db-config:
      logic-delete-field: flag  #全局逻辑删除字段值

</code></pre>
<h5 id="性能分析插件">性能分析插件</h5>
<blockquote>
<p>作用</p>
</blockquote>
<p>用于输出每条 SQL 语句及其执行时间</p>
<blockquote>
<p>使用方式</p>
</blockquote>
<p>spring使用方式：</p>
<pre><code class="language-xml">&lt;!-- SQL 执行性能分析，开发环境使用，线上不推荐。 maxTime 指的是 sql 最大执行时长 --&gt;
&lt;plugin interceptor=&quot;com.baomidou.mybatisplus.extension.plugins.PerformanceInterceptor&quot;&gt;
    &lt;property name=&quot;maxTime&quot; value=&quot;100&quot; /&gt;
    &lt;!--SQL是否格式化 默认false--&gt;
    &lt;property name=&quot;format&quot; value=&quot;true&quot; /&gt;
&lt;/plugin&gt;
</code></pre>
<p>springboot方式：</p>
<pre><code class="language-java">@Bean
@Profile({&quot;dev&quot;,&quot;test&quot;})
public PerformanceInterceptor performanceInterceptor(){
    PerformanceInterceptor performanceInterceptor = new PerformanceInterceptor();
    performanceInterceptor.setMaxTime(1);
    performanceInterceptor.setFormat(true);
    //....
    return performanceInterceptor;
}
</code></pre>
</p>

     <p class="md_block">
    <div class="reward"><div class="reward-button">赏 <span class="reward-code"> <span class="alipay-code"> <img class="alipay-img" src="https://Squid-dot.github.io/media/images/alipay.png"><b>支付宝扫码打赏</b> </span> <span class="wechat-code"> <img class="wechat-img" src="https://Squid-dot.github.io/media/images/wechat.png"><b>微信打赏</b> </span> </span></div></div>
</p> 
</div>

</div>



<link href="https://Squid-dot.github.io/styles/main.css" type="text/css" rel="stylesheet"/>

<div class="doc_comments">

</div>



  </div>
</div>



      </div>




    </div>

   <div class="footer">
<link href="https://Squid-dot.github.io/styles/main.css" type="text/css" rel="stylesheet"/><div class="site_footer_wrap"><div class="site_footer">

      <div class="mysocials"><div class="my_socials">
		   
			   
    
			   
    
			   
    
			   
    
</div><link href="https://Squid-dot.github.io/styles/main.css" type="text/css" rel="stylesheet"/>

      </div>

      <div class="copyright">Write by Squid
      </div>

</div></div>

    </div>


<style type="text/css">a.back_to_top {
    text-decoration: none;
    position: fixed;
    bottom: 40px;
    right: 30px;
    background: #f0f0f0;
    height: 40px;
    width: 40px;
    border-radius: 50%;
    line-height: 36px;
    font-size: 18px;
    text-align: center;
    transition-duration: .5s;
    transition-propety: background-color;
    display: none;
}

a.back_to_top span {
    color: #888;
}

a.back_to_top:hover {
    cursor: pointer;
    background: #dfdfdf;
}

a.back_to_top:hover span {
    color: #555;
}

@media print, screen and (max-width: 580px) {
    .back_to_top {
        display: none !important;
    }
}



</style><a id="back_to_top" href="#" class="back_to_top"><span>△</span>
</a>
<script type="text/javascript" src="https://Squid-dot.github.io/media/scripts/jquery.js"></script>

<script>$(document).ready((function(_this) {
  return function() {
    var bt;
    bt = $('#back_to_top');
    if ($(document).width() > 480) {
      $(window).scroll(function() {
        var st;
        st = $(window).scrollTop();
        if (st > 30) {
          return bt.css('display', 'block');
        } else {
          return bt.css('display', 'none');
        }
      });
      return bt.click(function() {
        $('body,html').animate({
          scrollTop: 0
        }, 800);
        return false;
      });
    }
  };
})(this));
</script>

</body>

</html>